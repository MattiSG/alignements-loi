<!DOCTYPE html>
<html>
	<head>
		<title>Aligner des notions</title>

		<link rel="stylesheet" href="//writ.cmcenroe.me/1.0.2/writ.min.css">
		<link rel="stylesheet" type="text/css" href="./main.css">
		<link rel="stylesheet" type="text/css" href="./buttons.css">

		<script type="text/javascript" src="https://cdn.jsdelivr.net/riot/2.3.17/riot+compiler.min.js"></script>

		<script src="sources/calculette-impot.js" type="riot/tag"></script>
	</head>
	<body>
		<h1>Représentations de notions à aligner</h1>

		<calculette-impot></calculette-impot>

		<form action="http://163.172.140.176/notions" method="POST">
			Les représentations accessibles aux adresses
			<input required type="url" placeholder="https://git.framasoft.org/openfisca/calculette-impots-m-source-code/blob/master/src/tgvH.m#L6515">
			et
			<input required type="url" placeholder="https://git.framasoft.org/french-tax-and-benefit-tables/ipp-tax-and-benefit-tables-yaml-clean/blob/master/baremes-ipp-impot-revenu-income-tax/bareme-ir.yaml#L48">
			représentent la même notion.

			<input type="submit" class="awesome orange" value="Valider">
		</form>

		<script src="https://cdn.rawgit.com/github/fetch/master/fetch.js"></script>

		<script>
			riot.mount('*');
		</script>

		<script>
			var form = document.forms[0];

			form.addEventListener('submit', function(event) {
				form.classList.remove('saved', 'error');
				form.classList.add('async');

				var urls = Array.from(document.querySelectorAll('input[type="url"]'))
								.map(function(input) { return input.value });

				fetch(form.action, {
					method: form.method,
					body: JSON.stringify(urls),
					headers: {
						'Content-Type': 'application/json',
					}
				}).then(
					function(response) { form.classList.add('saved') },
					function(response) { form.classList.add('error') }
				).then(function(response) {
					form.classList.remove('async');
				}, console.error.bind(console));

				event.preventDefault();
			});
		</script>
	</body>
</html>
